select distinct drf.refe,
        app.nmpessoa_pf as "Nome pessoa", 
        drf.nmpessoaexe as "Executor", 
        drf.nmpessoa as "Proponente" /*dúvida*/, 
        drf.dtassinatura as "Data Assinatura", 
        drf.dt_termino as "Data Término",
        drf.dstituloprojeto as "Título Projeto", 
        drf.total_bolsas as "Total Bolsas", 
        drf.fontepagototal as "Total Recebido", 
        drf.demandas as "Nome Demanda", 
        decode(td.cdtipodemanda,2,'Chamada Pública',td.nmtipodemanda) as "Tipo de Demanda"

from dagi_relatorio_fundos drf

inner join demanda d
on drf.iddemanda = d.iddemanda

inner join tipo_demanda td
on td.cdtipodemanda = d.cdtipodemanda

inner join V_ASSOCIA_PESSOAFISICA_PROJETO app
on drf.refe = formata_ref(app.nrreferencia)
and app.cdparticipacao_inst = 2 -- executor
and app.cdparticipacao_pf = 4 -- coordenador

where drf.fonte = 'CT-AMAZONIA'
and to_char(drf.dtassinatura,'yyyy') between 2010 and 2020
