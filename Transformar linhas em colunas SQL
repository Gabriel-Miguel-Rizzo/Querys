----- DICA GERAL NR 1 (TRANSFORMAR LINHAS EM COLUNAS NO SQL) ------

EXISTEM 2 MANEIRAS:
*** Usar o case when dentro do agrupamento MAX() para criar novas colunas com base as informações das linhas
*** Usar a função PIVOT do SQL 

Exemplos Resumidos:

--PIVOT --
SELECT
    ID,
    MAX(CASE WHEN Tipo = 'A' THEN Valor END) AS A,
    MAX(CASE WHEN Tipo = 'B' THEN Valor END) AS B,
    MAX(CASE WHEN Tipo = 'C' THEN Valor END) AS C
FROM SuaTabela
GROUP BY ID; 


--UNPIVOT---
SELECT ID, 'A' AS Tipo, A AS Valor FROM TabelaPivotada
UNION
SELECT ID, 'B' AS Tipo, B AS Valor FROM TabelaPivotada
UNION
SELECT ID, 'C' AS Tipo, C AS Valor FROM TabelaPivotada;





























EX de case when + MAX() :




SELECT TAB.CODIGO  , tab.TOTAL_OHBOY Total_OHBOY, tab.TOTAL_YOBOH Total_YOBOH,(TAB.TOTAL_OHBOY + TAB.TOTAL_YOBOH)  Total_Geral,
CASE
WHEN  (TAB.TOTAL_YOBOH + TAB.TOTAL_OHBOY) <> 0  THEN                 
 TAB.TOTAL_YOBOH / (TAB.TOTAL_YOBOH + TAB.TOTAL_OHBOY)
 ELSE 0
 END  AS PART_YOBOH

FROM
(

SELECT lv.CODIGO_CLIENTE CODIGO, SUM(
case when upper(p.GRIFFE) like 'YOBOH' THEN
cast(lvp.QTDE as decimal(5,2))  ELSE 0
END) as TOTAL_YOBOH,
SUM(
case when upper(p.GRIFFE) like 'OH BOY' THEN
cast(lvp.QTDE as decimal(5,2)) ELSE 0
END) as TOTAL_OHBOY

FROM LOJA_VENDA lv
INNER JOIN LOJA_VENDA_PRODUTO lvp ON
lv.CODIGO_FILIAL = lvp.CODIGO_FILIAL AND
lv.TICKET = lvp.TICKET AND
lv.DATA_VENDA = lvp.DATA_VENDA

INNER JOIN PRODUTOS p ON
lvp.PRODUTO = p.PRODUTO


WHERE lv.CODIGO_CLIENTE IN (

*lista de CPF'S Aqui*
)
AND
lvp.QTDE > 0
AND
p.GRIFFE NOT LIKE RTRIM(UPPER('SACADA'))
AND
YEAR(lv.DATA_VENDA) = 2023

GROUP BY lv.CODIGO_CLIENTE

) Tab

ORDER BY 1
